/* styles.css — Grid Rogue v1.1.0 */

:root{
  --bg0:#0b0b10;
  --bg1:#08080d;
  --panel:rgba(18,18,28,.92);
  --panel2:rgba(26,26,40,.92);
  --stroke:rgba(255,255,255,.10);
  --stroke2:rgba(255,255,255,.16);
  --txt:#e9ecff;
  --muted:rgba(233,236,255,.72);
  --muted2:rgba(233,236,255,.56);
  --accent:#6ab0ff;
  --good:#2ef2a0;
  --warn:#ffd35a;
  --bad:#ff6b3d;
  --danger:#ff2b4d;

  --r:16px;
  --r2:12px;
  --shadow:0 18px 46px rgba(0,0,0,.42);
  --vh:1vh;

  --topbarH:64px;

  /* Safe-area helpers */
  --safeL: env(safe-area-inset-left, 0px);
  --safeR: env(safe-area-inset-right, 0px);
  --safeT: env(safe-area-inset-top, 0px);
  --safeB: env(safe-area-inset-bottom, 0px);
}

*{box-sizing:border-box}

/* ✅ FIX CRÍTICO: hidden siempre gana */
[hidden]{display:none !important}
.overlay[hidden]{display:none !important}
.dpad[hidden]{display:none !important}

html,body{
  height:100%;
  margin:0;
  background:linear-gradient(180deg,var(--bg0),var(--bg1));
  color:var(--txt);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}
body{
  overscroll-behavior:none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.ms{
  font-family:"Material Symbols Rounded";
  font-weight:600;
  font-style:normal;
  font-size:22px;
  line-height:1;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  vertical-align:middle;
  user-select:none;
}

.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
.tiny{font-size:12px}
.muted{color:var(--muted)}
.noscriptBar{padding:10px 12px;background:#120f16;border-bottom:1px solid var(--stroke);text-align:center}

#app{
  height:calc(var(--vh)*100);
  display:flex;
  flex-direction:column;
  min-height:100%;
}

/* ───────── Topbar ───────── */
.topbar{
  min-height:var(--topbarH);
  height:auto;
  display:grid;
  grid-template-columns: minmax(190px, 300px) minmax(0, 1fr) auto;
  align-items:center;
  gap:12px;
  padding:calc(10px + var(--safeT)) calc(12px + var(--safeR)) 10px calc(12px + var(--safeL));
  border-bottom:1px solid rgba(255,255,255,.08);
  background:linear-gradient(180deg,rgba(10,10,16,.92),rgba(10,10,16,.72));
  backdrop-filter:blur(10px);
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}
.brandDot{
  width:12px;height:12px;border-radius:999px;
  background:radial-gradient(circle at 30% 30%,#fff,rgba(255,255,255,.15) 55%,rgba(106,176,255,.55));
  box-shadow:0 0 14px rgba(106,176,255,.35);
  flex:0 0 auto;
}
.brandText{min-width:0}
.brandTitle{font-weight:900;letter-spacing:.2px;line-height:1.05}
.brandSub{
  font-size:12px;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width: 320px;
}

.miniStats{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;

  /* ✅ evita que “reviente” el header: scroll suave si falta espacio */
  overflow:auto;
  scrollbar-width:none;
  -ms-overflow-style:none;
  padding:2px 0;
  justify-content:center;
}
.miniStats::-webkit-scrollbar{display:none}

.actions{
  display:flex;
  align-items:center;
  gap:8px;
  flex:0 0 auto;
}

/* Pills */
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border:1px solid var(--stroke);
  border-radius:999px;
  background:rgba(255,255,255,.03);
  color:var(--txt);
  font-size:12px;
  flex:0 0 auto;
  max-width: 100%;
}
.pill .pv{font-weight:800;min-width:0}
.pill.mini{padding:5px 9px}
.pill.subtle{background:rgba(255,255,255,.02);color:var(--muted)}
.pillBtn{cursor:pointer;user-select:none}
.pillBtn:hover{border-color:var(--stroke2);background:rgba(255,255,255,.05)}
.pillBtn:active{transform:translateY(1px)}
.pill .ms{font-size:18px;opacity:.92}

/* Buttons */
.iconBtn{
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.03);
  color:var(--txt);
  border-radius:12px;
  padding:8px 10px;
  cursor:pointer;
}
.iconBtn.small{padding:8px 10px;border-radius:12px}
.iconBtn:hover{border-color:var(--stroke2);background:rgba(255,255,255,.06)}
.iconBtn:active{transform:translateY(1px)}
.iconBtn .ms{font-size:20px}

.btn{
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.05);
  color:var(--txt);
  border-radius:12px;
  padding:10px 12px;
  cursor:pointer;
  font-weight:800;
}
.btn:hover{border-color:var(--stroke2);background:rgba(255,255,255,.08)}
.btn:active{transform:translateY(1px)}
.btn.primary{border-color:rgba(106,176,255,.30);background:rgba(106,176,255,.16)}
.btn.primary:hover{background:rgba(106,176,255,.22)}
.btn.danger{border-color:rgba(255,43,77,.28);background:rgba(255,43,77,.14)}
.btn.danger:hover{background:rgba(255,43,77,.18)}
.btnBlock{width:100%}
.btn:disabled{opacity:.45;cursor:not-allowed;transform:none}

/* Stage */
.stage{
  flex:1;
  min-height:0;
  position:relative;
  overflow:hidden;
}

/* Canvas area */
.canvasWrap{
  position:relative;
  height:100%;
  padding:12px;
  padding-bottom:calc(12px + var(--safeB));
}
.gameArea{
  height:100%;
  display:flex;
  align-items:stretch;
  justify-content:center;
  min-height:0;
}

.railFrame{
  width:min(1100px,100%);
  height:100%;
  display:grid;
  grid-template-columns: 340px minmax(0,1fr);
  gap:12px;
  align-items:stretch;
  min-height:0;
}

.railHud,
.railCanvas{
  min-width:0;
  min-height:0;
}

.railHud{
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:12px;
  overflow:hidden;
}
.hud{display:flex;flex-direction:column;gap:10px;height:100%;min-height:0}

.comboTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
.comboSeq{display:flex;flex-wrap:wrap;gap:8px;min-width:0}
.comboTimer{
  display:inline-flex;align-items:center;gap:8px;
  padding:7px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.22);
  flex:0 0 auto;
}
.comboHint{font-size:12px;color:var(--muted)}
.levelProg{margin-top:4px}
.levelRow{display:flex;align-items:center;justify-content:space-between;color:var(--muted);gap:10px}
.levelRow .left{display:inline-flex;align-items:center;gap:8px;min-width:0}
.progBar{
  height:10px;border-radius:999px;background:rgba(255,255,255,.06);
  overflow:hidden;border:1px solid rgba(255,255,255,.08)
}
.progFill{
  height:100%;width:0%;
  background:linear-gradient(90deg,rgba(106,176,255,.92),rgba(214,133,255,.92));
  border-radius:999px
}

.toast{
  margin-top:auto;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.28);
  color:rgba(255,255,255,.92);
  box-shadow:0 14px 38px rgba(0,0,0,.25);
  transform:translateY(6px);
  opacity:0;
  transition:opacity .18s ease, transform .18s ease;
}
.toast.show{opacity:1;transform:translateY(0)}

/* Canvas side */
.railCanvas{
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.08);
  background:radial-gradient(circle at 30% 10%, rgba(106,176,255,.10), rgba(0,0,0,.10));
  overflow:hidden;
}
.canvasSizer{
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:12px;
  min-height:0;
}
#gameCanvas{
  display:block;
  image-rendering:pixelated;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background:#000;
  box-shadow:0 18px 60px rgba(0,0,0,.45);

  /* ✅ nunca se sale del frame */
  max-width:100%;
  max-height:100%;
  width:auto;
  height:auto;
}

/* Overlays */
.overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.52);
  backdrop-filter:blur(10px);
  z-index:60;
}
.panel{
  width:min(560px, calc(100% - 24px));
  border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background:linear-gradient(180deg,var(--panel),rgba(18,18,28,.84));
  box-shadow:var(--shadow);
  overflow:hidden;
  max-height: calc(100% - 24px);
}
.panel.wide{width:min(880px, calc(100% - 24px))}
.panelHead{
  padding:14px 16px;
  border-bottom:1px solid rgba(255,255,255,.08);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.panelBody{padding:14px 16px}
.panelActions{
  padding:14px 16px;
  border-top:1px solid rgba(255,255,255,.08);
  display:flex;
  gap:10px;
  justify-content:flex-end;
  flex-wrap:wrap;
}
.panelActionsLeft{justify-content:flex-start}
.panelActionsStretch{justify-content:stretch}
.panelActionsStretch > *{flex:1}

.h2{font-size:18px;font-weight:900}
.splash{display:flex;align-items:center;gap:12px;padding:16px}
.splashCompact{padding:14px 16px}
.splashLogo{
  width:44px;height:44px;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(106,176,255,.14);
}
.splashLogo .ms{font-size:26px}
.splashText .title{font-weight:900;letter-spacing:.2px}
.splashText .sub{color:var(--muted);font-size:12px}

/* Loading bar */
.loadingPanel{max-width:520px}
.loadingBar{
  height:10px;border-radius:999px;background:rgba(255,255,255,.06);
  margin:10px 16px;border:1px solid rgba(255,255,255,.08);overflow:hidden
}
.loadingBarFill{
  height:100%;width:55%;
  background:linear-gradient(90deg,rgba(106,176,255,.80),rgba(214,133,255,.80));
  animation:bar 1.1s ease-in-out infinite alternate
}
@keyframes bar{from{transform:translateX(-20%)}to{transform:translateX(20%)}}
.dots{display:inline-flex;gap:5px;margin-left:6px}
.dots .dot{width:6px;height:6px;border-radius:999px;background:rgba(255,255,255,.75);opacity:.35;animation:dot 1s infinite}
.dots .dot:nth-child(2){animation-delay:.15s}
.dots .dot:nth-child(3){animation-delay:.30s}
@keyframes dot{0%{opacity:.25;transform:translateY(0)}50%{opacity:.9;transform:translateY(-2px)}100%{opacity:.25;transform:translateY(0)}}

/* Forms */
.form{padding:14px 16px 16px}
.label{display:block;margin:10px 0 6px;color:var(--muted);font-size:12px}
.row{display:flex;align-items:center;min-width:0}
.rowGap{gap:10px}
.input,.select{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.24);
  color:var(--txt);
  outline:none;
}
.input:focus,.select:focus{border-color:rgba(106,176,255,.35)}
.helpText{margin-top:10px}

/* Upgrades */
.upgradesPanel .panelBody{padding:12px 16px 16px}
.upgradeChoices{
  display:grid;
  grid-template-columns:repeat(3, minmax(0, 1fr));
  gap:10px;
}
.upCard{
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.22);
  padding:12px;
  cursor:pointer;
  user-select:none;
  transition:transform .12s ease, border-color .12s ease, background .12s ease;
  min-width:0;
}
.upCard:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.18);background:rgba(0,0,0,.28)}
.upCard:active{transform:translateY(0)}
.upHead{display:flex;gap:10px;align-items:flex-start;min-width:0}
.upIcon{
  width:40px;height:40px;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.05);
  flex:0 0 auto;
}
.upIcon .ms{font-size:22px}
.upTitle{font-weight:900;min-width:0}
.upSubRow{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.badge{
  font-size:11px;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.03);
  color:var(--muted);
}
.upRarityBadge{font-weight:900;color:rgba(255,255,255,.92)}
.upDesc{margin-top:10px;color:rgba(233,236,255,.86);font-size:12px;line-height:1.45}

.upCard[data-rarity="common"] .upIcon{background:rgba(255,255,255,.05)}
.upCard[data-rarity="rare"] .upIcon{background:rgba(106,176,255,.14);border-color:rgba(106,176,255,.22)}
.upCard[data-rarity="epic"] .upIcon{background:rgba(214,133,255,.14);border-color:rgba(214,133,255,.22)}
.upCard[data-rarity="legendary"] .upIcon{background:rgba(255,211,90,.14);border-color:rgba(255,211,90,.24)}

.upgradesActions{justify-content:space-between}

/* Game over */
.goBig{padding:14px 16px 6px;display:flex;justify-content:space-between;align-items:flex-end;gap:12px}
.goScore{font-size:44px;font-weight:900;letter-spacing:.2px}
.goBest{color:var(--muted);font-weight:900}
.goBest .v{color:rgba(255,255,255,.92)}
.stats{padding:8px 16px 0}
.stats .line{display:flex;justify-content:space-between;gap:12px;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,.08)}
.stats .line:last-child{border-bottom:none}

/* Options */
.optionsPanel .panelHead{
  position:sticky;
  top:0;
  background:linear-gradient(180deg,rgba(18,18,28,.96),rgba(18,18,28,.82));
  z-index:1;
}
.options{
  max-height:min(70vh, 560px);
  overflow:auto;
  padding:12px 16px 16px;
}
.optGroupTitle{
  display:flex;align-items:center;gap:10px;
  margin:10px 0 8px;
  padding:8px 10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.03);
  font-weight:900;
}
.optRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:10px 10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.18);
  margin-bottom:10px;
  min-width:0;
}
.optRow input[type="checkbox"]{width:18px;height:18px;accent-color:var(--accent)}
.sliderRow{align-items:center}
.sliderRow input[type="range"]{flex:1;accent-color:var(--accent)}
.legal{margin-top:10px;padding:8px 4px;opacity:.85}

/* Error box */
.errorBox{
  padding:12px 12px;
  border-radius:14px;
  border:1px solid rgba(255,43,77,.22);
  background:rgba(255,43,77,.10);
  color:rgba(255,255,255,.92);
  word-break:break-word;
}

/* ───────── HUD float layer (corazones + buffs) ───────── */
#hudFloat{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:40;
  overflow:visible;

  /* ✅ centrado y seguro: nunca sale del viewport */
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:12px;
  padding-top:calc(12px + var(--safeT));
}
.statusBar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:8px 10px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.22);
  box-shadow:0 12px 34px rgba(0,0,0,.30);
  pointer-events:none;

  width:min(980px, calc(100% - 12px));
  max-width:100%;
  min-width:0;
}
.statusBar.compact{padding:7px 9px}

.hpWrap{
  display:flex;
  align-items:center;
  gap:8px;
  min-width:0;
  flex:0 0 auto;
}
.hpWrap .hpIcon{color:rgba(255,120,120,.92)}
.hpHearts{
  display:inline-flex;
  gap:2px;
  flex-wrap:nowrap;
  min-width:0;
  max-width: 52vw; /* ✅ no invade buffs */
  overflow:hidden;
}
.heart{display:inline-flex;align-items:center;justify-content:center}
.heart.full{color:rgba(255,120,120,.92)}
.heart.empty{color:rgba(255,255,255,.22)}
.hpMore{color:var(--muted);font-weight:900;flex:0 0 auto}
.hpText{color:var(--muted);font-weight:900;flex:0 0 auto}

.buffBar{
  display:flex;
  align-items:center;
  gap:8px;
  justify-content:flex-end;
  flex-wrap:wrap;
  min-width:0;
  flex:1 1 auto;
}
.buffBadge{
  display:inline-flex;align-items:center;gap:6px;
  padding:6px 8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.03);
  max-width:100%;
}
.buffBadge .bIcon{font-size:18px;color:rgba(255,255,255,.86)}
.buffBadge .bTime,.buffBadge .bCount{font-size:12px;color:rgba(255,255,255,.86);font-weight:900}

/* Upgrade FX canvas */
.upFxCanvas{position:absolute;inset:0;pointer-events:none}

/* ───────── D-PAD (a los lados, no abajo) ───────── */
/* El contenedor ocupa toda la pantalla pero no bloquea clicks salvo botones */
.dpad{
  position:fixed;
  inset:0;
  z-index:55;
  pointer-events:none;
}

/* Ignoramos layout interno (row) y colocamos botones en “side rails” */
.dpadRow{display:contents}

.dpadBtn{
  width:58px;height:58px;
  border-radius:20px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.24);
  color:rgba(255,255,255,.92);
  cursor:pointer;
  pointer-events:auto;
  touch-action:manipulation;

  box-shadow:0 14px 36px rgba(0,0,0,.28);
  backdrop-filter: blur(6px);
}

.dpadBtn:hover{border-color:rgba(255,255,255,.18);background:rgba(0,0,0,.30)}
.dpadBtn:active{transform:translateY(1px)}
.dpadBtn .ms{font-size:30px}

/* Posicionamiento: left y right en los laterales; up/down en el lateral derecho (no tapa el juego) */
#btnLeft{
  position:fixed;
  left:calc(12px + var(--safeL));
  top:50%;
  transform:translateY(-50%);
}
#btnRight{
  position:fixed;
  right:calc(12px + var(--safeR));
  top:50%;
  transform:translateY(-50%);
}
#btnUp{
  position:fixed;
  right:calc(12px + var(--safeR));
  top:calc(50% - 86px);
}
#btnDown{
  position:fixed;
  right:calc(12px + var(--safeR));
  top:calc(50% + 86px);
}

/* ───────── Responsive ───────── */
@media (max-width: 980px){
  .railFrame{grid-template-columns: 1fr; gap:10px}
  .railHud{order:2}
  .railCanvas{order:1; min-height:280px}
  .miniStats{justify-content:flex-start}
  .brandSub{max-width: 220px}
}

@media (max-width: 520px){
  :root{--topbarH:74px}

  .topbar{
    grid-template-columns: minmax(160px, 1fr) minmax(0, 1fr) auto;
    padding:calc(10px + var(--safeT)) calc(10px + var(--safeR)) 10px calc(10px + var(--safeL));
    gap:10px;
  }

  .brandSub{display:none}

  .upgradeChoices{grid-template-columns:1fr; gap:10px}

  /* HUD: apila para que NUNCA se salga */
  .statusBar{
    flex-direction:column;
    align-items:stretch;
    gap:8px;
  }
  .buffBar{justify-content:flex-start}

  /* D-pad un pelín más compacto en móviles pequeños */
  .dpadBtn{width:54px;height:54px;border-radius:18px}
  #btnUp{top:calc(50% - 78px)}
  #btnDown{top:calc(50% + 78px)}
}

/* Mejoras extra para dispositivos táctiles */
@media (pointer: coarse){
  .dpadBtn{background:rgba(0,0,0,.28)}
}
