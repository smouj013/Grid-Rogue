<!doctype html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
  <meta name="color-scheme" content="dark light" />
  <meta name="format-detection" content="telephone=no" />

  <meta name="theme-color" content="#e60012" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Grid Runner" />

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./assets/icons/favicon-32.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon-180.png" sizes="180x180" />
  <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon-167.png" sizes="167x167" />
  <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon-152.png" sizes="152x152" />

  <title>Grid Runner</title>
  <link rel="stylesheet" href="./styles.css" />
  <script>window.APP_VERSION="0.0.9";</script>
</head>

<body>
  <div class="app" id="app">

    <!-- TOP BAR (NO roba pantalla, NO envuelve) -->
    <header class="topbar">
      <div class="brand">
        <div class="dot" aria-hidden="true"></div>
        <div class="title">Grid Runner</div>
        <span class="pill subtle" id="pillPlayer">üë§ ‚Äî</span>
        <span class="pill warn" id="pillOffline" hidden>Offline</span>
      </div>

      <div class="actions">
        <button class="iconBtn ghost" id="btnInstall" hidden title="Instalar">
          <span class="ico">‚¨áÔ∏è</span><span class="lbl">Instalar</span>
        </button>
        <button class="iconBtn" id="btnOptions" title="Opciones">
          <span class="ico">‚öôÔ∏è</span><span class="lbl">Opciones</span>
        </button>
        <button class="iconBtn primary" id="btnPause" title="Pausa">
          <span class="ico">‚è∏</span><span class="lbl">Pausa</span>
        </button>
      </div>
    </header>

    <!-- STATUS BAR (horizontal scroll ONLY si hace falta; NUNCA crea scroll vertical) -->
    <section class="statusbar" aria-label="HUD">
      <div class="hudItem">
        <div class="k">Score</div>
        <div class="v" id="hudScore">0</div>
      </div>
      <div class="hudItem">
        <div class="k">Racha</div>
        <div class="v" id="hudStreak">0</div>
      </div>
      <div class="hudItem">
        <div class="k">Mult</div>
        <div class="v" id="hudMult">x1</div>
      </div>
      <div class="hudItem">
        <div class="k">Nivel</div>
        <div class="v" id="hudLevel">1</div>
      </div>
      <div class="hudItem">
        <div class="k">Vel</div>
        <div class="v" id="hudSpeed">1.0</div>
      </div>

      <!-- Combo visible sin tapar el grid (est√° en la barra, no dentro del canvas) -->
      <div class="comboMini" id="comboMini">
        <div class="comboTopMini">
          <span class="comboT" id="comboTitle">Combo</span>
          <span class="comboTime" id="comboTimer">‚Äî</span>
        </div>
        <div class="comboSeqMini" id="comboSeq"></div>
        <div class="comboHintMini" id="comboHint">Coge el orden para bonus</div>
      </div>

      <!-- Leyenda compacta -->
      <div class="legendMini" id="legendMini" aria-label="Leyenda">
        <span class="lItem"><i class="chip cCoin"></i>+10</span>
        <span class="lItem"><i class="chip cGem"></i>+30</span>
        <span class="lItem"><i class="chip cBonus"></i>+60</span>
        <span class="lItem"><i class="chip cTrap"></i>-25</span>
        <span class="lItem"><i class="chip cBlock"></i>KO</span>
      </div>
    </section>

    <!-- MAIN: el canvas ocupa TODO el resto del alto (sin scroll) -->
    <main class="main">
      <div class="stage" id="stage">
        <canvas id="game" aria-label="Juego"></canvas>

        <!-- Tap zonas (r√°pidas) -->
        <div class="tapZones" aria-hidden="true">
          <div class="zone" id="zoneLeft"></div>
          <div class="zone" id="zoneRight"></div>
        </div>

        <!-- D-PAD -->
        <div class="dpad" id="dpad" aria-label="D-Pad">
          <button class="dpadBtn up" id="dpadUp">‚ñ≤</button>
          <button class="dpadBtn left" id="dpadLeft">‚óÄ</button>
          <button class="dpadBtn right" id="dpadRight">‚ñ∂</button>
          <button class="dpadBtn down" id="dpadDown">‚ñº</button>
        </div>

        <div class="toast" id="toast" hidden>‚Äî</div>

        <!-- LOADING (m√≠n 5s) -->
        <div class="overlay overlayLoading" id="overlayLoading">
          <div class="panel loading">
            <div class="loadingTitle">Grid Runner</div>
            <div class="loadingSpinner" aria-hidden="true"></div>
            <div class="loadingText" id="loadingText">Cargando‚Ä¶</div>
            <div class="muted small" id="loadingSub">Preparando la cuadr√≠cula</div>
          </div>
        </div>

        <!-- START -->
        <div class="overlay" id="overlayStart" hidden>
          <div class="panel start">
            <h1>Bienvenido</h1>
            <p class="muted">Pon tu nombre y dale a <b>Jugar</b>.</p>

            <div class="field">
              <label for="startName">Nombre</label>
              <input id="startName" class="fieldInput" maxlength="16"
                     placeholder="Tu nombre (m√≠n. 2)" inputmode="text" autocomplete="nickname" />
            </div>

            <div class="startStats">
              <div class="stat">
                <div class="statLabel">Mejor</div>
                <div class="statValue" id="startBest">0</div>
              </div>
              <div class="stat">
                <div class="statLabel">Runs</div>
                <div class="statValue" id="startRuns">0</div>
              </div>
            </div>

            <div class="rowBtns">
              <button class="btn primary big" id="btnStart" disabled>Jugar</button>
            </div>

            <p class="tiny muted">
              Controles: Swipe (4 dirs), teclado (WASD/Flechas) o D-Pad.
            </p>
          </div>
        </div>

        <!-- PAUSE -->
        <div class="overlay" id="overlayPaused" hidden>
          <div class="panel">
            <h2>Pausa</h2>
            <p class="muted">Pulsa continuar para seguir.</p>
            <div class="rowBtns">
              <button class="btn primary big" id="btnResume">Continuar</button>
            </div>
          </div>
        </div>

        <!-- GAME OVER -->
        <div class="overlay" id="overlayGameOver" hidden>
          <div class="panel">
            <h2>KO</h2>
            <p class="muted" id="finalLine">‚Äî</p>
            <div class="rowBtns">
              <button class="btn primary big" id="btnPlayAgain">Otra</button>
              <button class="btn ghost big" id="btnBackToStart">Inicio</button>
            </div>
          </div>
        </div>

        <!-- UPGRADES -->
        <div class="overlay" id="overlayUpgrades" hidden>
          <div class="panel wide">
            <h2>Subes de nivel</h2>
            <p class="muted">Elige 1 mejora (roguelike).</p>
            <div class="upgGrid">
              <button class="upgCard" id="upg0" type="button"></button>
              <button class="upgCard" id="upg1" type="button"></button>
              <button class="upgCard" id="upg2" type="button"></button>
            </div>
            <p class="tiny muted">Las mejoras se acumulan. Algunas tienen l√≠mite.</p>
          </div>
        </div>

        <!-- OPTIONS -->
        <div class="overlay" id="overlayOptions" hidden>
          <div class="panel options">
            <div class="panelTop">
              <h2>Opciones</h2>
              <button class="iconBtn ghost" id="btnCloseOptions" aria-label="Cerrar opciones">
                <span class="ico">‚úï</span><span class="lbl">Cerrar</span>
              </button>
            </div>

            <div class="optGrid">
              <div class="optRow">
                <div class="optLeft">
                  <div class="optTitle">Sprites</div>
                  <div class="optDesc">Si faltan, usa colores (no rompe).</div>
                </div>
                <label class="switch">
                  <input type="checkbox" id="optSprites" />
                  <span class="slider"></span>
                </label>
              </div>

              <div class="optRow">
                <div class="optLeft">
                  <div class="optTitle">Vibraci√≥n</div>
                  <div class="optDesc">Solo m√≥vil compatible.</div>
                </div>
                <label class="switch">
                  <input type="checkbox" id="optVibration" />
                  <span class="slider"></span>
                </label>
              </div>

              <div class="optRow">
                <div class="optLeft">
                  <div class="optTitle">D-Pad</div>
                  <div class="optDesc">√ötil en m√≥vil.</div>
                </div>
                <label class="switch">
                  <input type="checkbox" id="optDpad" />
                  <span class="slider"></span>
                </label>
              </div>

              <div class="optRow">
                <div class="optLeft">
                  <div class="optTitle">FX</div>
                  <div class="optDesc">Intensidad de animaciones/juice.</div>
                </div>
                <input type="range" id="optFx" min="0.4" max="1.25" step="0.05" />
                <div class="optValue" id="optFxValue">1.00</div>
              </div>

              <div class="optRow">
                <div class="optLeft">
                  <div class="optTitle">Borrar historial local</div>
                  <div class="optDesc">Elimina runs guardados.</div>
                </div>
                <button class="btn" id="btnClearLocal">Borrar</button>
              </div>
            </div>

            <p class="muted small">
              Consejo: en iOS, ‚ÄúA√±adir a pantalla de inicio‚Äù para instalar.
            </p>
          </div>
        </div>

      </div>
    </main>

  </div>

  <script src="./app.js" defer></script>
</body>
</html>
